<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>jenkins配置 | xin&#39;s blog</title>
  <meta name="author" content="dai changxin">
  
  <meta name="description" content="启动
强烈建议使用jenkins.war文件，并用命令行启动jenkins，这样可以自定义端口号，访问路径后缀，和自定义workspace的目录
可能会提示说java的版本过高，启动时加入参数 --enable-future-java来解决
我的启动脚本：

mac:12export JENKINS">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="jenkins配置">
  <meta property="og:site_name" content="xin&#39;s blog">

  
    <meta property="og:image" content="undefined">
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="xin&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <script src="/js/jquery-3.2.1.min.js"></script>
</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">xin&#39;s blog</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2019-02-20T07:35:00.000Z"><a href="/2019/02/20/jenkins-setup/">2019-02-20</a></time>
      
      
  
    <h1 class="title">jenkins配置</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><ol>
<li>强烈建议使用jenkins.war文件，并用命令行启动jenkins，这样可以自定义端口号，访问路径后缀，和自定义workspace的目录</li>
<li>可能会提示说java的版本过高，启动时加入参数 <code>--enable-future-java</code>来解决</li>
<li>我的启动脚本：</li>
</ol>
<p>mac:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JENKINS_HOME</span>=/Users/xin/workspace/jenkins</span><br><span class="line">java -jar jenkins.war --enable-future-java <span class="attribute">--httpPort</span>=8080 <span class="attribute">--prefix</span>=/jenkins</span><br></pre></td></tr></table></figure></p>
<p>win:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> <span class="attribute">JENKINS_HOME</span>=C:\jenkins</span><br><span class="line">java -jar jenkins.war --enable-future-java <span class="attribute">--httpPort</span>=8080 <span class="attribute">--prefix</span>=/jenkins</span><br></pre></td></tr></table></figure></p>
<h2 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a>账号管理</h2><ol>
<li>默认是admin登录，登录密码在<code>/secrets/initialAdminPassword</code>中，不要尝试创建用户名为<code>admin</code>或<code>administrator</code>的账号了</li>
<li>在<code>系统管理</code>-&gt;<code>全局安全设置</code>中启用jenkins用户注册，并勾选<code>注册用户可做任何事</code></li>
<li>注册一个管理员账户，如<code>admin001</code>，并进入全局安全设置中把<code>注册用户可做任何事</code>取消，选择<code>项目矩阵授权策略</code>, 然后勾选<code>admin001</code>账户拥有全部权限</li>
<li>到此，可以任何人注册账户，但是没有任何权限，管理员账户可以手动给每个账户加权限</li>
</ol>
<h2 id="乱码问题"><a href="#乱码问题" class="headerlink" title="乱码问题"></a>乱码问题</h2><ol>
<li><p>执行脚本中有中文输出，显示乱码：<br>在<code>系统管理</code>-&gt;<code>系统设置</code>-&gt;<code>环境变量</code>中，增加键值对，key为<code>LANG</code>,value为<code>zh_CN.UTF-8</code></p>
</li>
<li><p>bat脚本中有乱码<br>在每个bat脚本执行前，加入一行bat脚本：</p>
</li>
</ol>
<p><code>chcp 65001</code></p>
<h2 id="环境问题"><a href="#环境问题" class="headerlink" title="环境问题"></a>环境问题</h2><ol>
<li>执行时会遇到环境找不到的问题，比如egret编译会提示说找不到引擎：<br>因为jenkins使用了自己的APP_DATA环境目录，并不是系统默认的，所以找不到各个引擎对应的位置，在jenkins的<code>环境变量</code>中增加键值对，key为<code>APPDATA</code>，value为<code>C:\\Users\\你的计算机用户名\\AppData\\Roaming\\</code></li>
</ol>
<h2 id="Git使用的问题"><a href="#Git使用的问题" class="headerlink" title="Git使用的问题"></a>Git使用的问题</h2><ol>
<li><p>默认git只拉取一个仓库到本job的工作目录中，如果要拉取多个git:<br>pipeline的job使用<code>dir(&#39;目录名&#39;)</code>实现<br>自由风格job使用<code>Git Plugin</code>自带的分目录功能:<code>Additional Behaviours</code>-&gt;<code>Check out to a sub-directory</code>即可</p>
</li>
<li><p>提示‘tell me who you are’<br>执行脚本中加入：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git<span class="built_in"> config </span>--local user.email <span class="string">"你的邮箱"</span></span><br><span class="line">git<span class="built_in"> config </span>--local user.name <span class="string">"你的用户名"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>账号和密码方式操作https路径的git仓库，会出现卡住而且没有任何报错提示问题<br>在全局密钥中增加账号密码的密钥，并使用该密钥操作git仓库。其次<strong>仓库的路径要加上用户名</strong>，比如: <code>https://daichangxin@gitlab.xiangwushuo.com/game/gameBuild.git</code></p>
</li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li><p>调用其他job传参<br>传参中如果使用单引号，则是直接原封不动的传递过去，如果是双引号，则是先在本job中解析完，再传递过去。先解析的优势是有些变量是只有本job才知道的。<br>例如：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">copyFrom</span> = <span class="string">"<span class="variable">$&#123;JENKINS_HOME&#125;</span>\\workspace\\<span class="variable">$&#123;JOB_NAME&#125;</span>\\source\\<span class="variable">$&#123;game_id&#125;</span>\\bin-release\\web\\<span class="variable">$&#123;client_version&#125;</span>"</span></span><br><span class="line">copyTo = <span class="string">"<span class="variable">$&#123;JENKINS_HOME&#125;</span>\\workspace\\gameBuild\\gamebox\\<span class="variable">$&#123;build_type&#125;</span>\\<span class="variable">$&#123;game_id&#125;</span>\\"</span></span><br><span class="line">build job: <span class="string">'gameBuild'</span>, parameters: [string(name: <span class="string">'copyFrom'</span>, value: copyFrom), string(name: <span class="string">'copyTo'</span>, value: copyTo)]</span><br></pre></td></tr></table></figure>
</li>
<li><p>bat执行参数过长或有空格<br>路径过长或有空格需要用引号括起来，而且路径要用反斜杠<code>\\</code>不能用<code>/</code>，否则就会提示参数不正确，因为bat的参数是用斜杠来标识参数名的<br>复制文件到目标目录中，如果不想被提示说目标是不是目录，则在目标路径后方加上<code>\\</code>，如：</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001 &amp; xcopy "source<span class="symbol">\\</span><span class="variable">%game_id%</span><span class="symbol">\\</span>bin-release<span class="symbol">\\</span>web<span class="symbol">\\</span><span class="variable">%client_version%</span>" "<span class="variable">%JENKINS_HOME%</span><span class="symbol">\\</span>workspace<span class="symbol">\\</span>gameBuild<span class="symbol">\\</span>gamebox<span class="symbol">\\</span><span class="variable">%build_type%</span><span class="symbol">\\</span><span class="variable">%game_id%</span><span class="symbol">\\</span>" /s /h /d /y</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/jenkins/">jenkins</a>
  </div>

        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


	<section id="comment">
		

	</section>
	
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.greatxin.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/egret/">egret</a><small>2</small></li>
  
    <li><a href="/categories/flash/">flash</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/egret/h5/">h5</a><small>1</small></li>
  
    <li><a href="/categories/jenkins/">jenkins</a><small>1</small></li>
  
    <li><a href="/categories/python/">python</a><small>2</small></li>
  
    <li><a href="/categories/脚本/">脚本</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/jenkins/">jenkins</a><small>1</small></li>
  
    <li><a href="/tags/脚本/">脚本</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2019 dai changxin
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>